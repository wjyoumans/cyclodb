\r abelianbnf.gp

\\ len = 969 max = 2310
conductors = [4, 3, 6, 8, 5, 10, 12, 9, 7, 18, 14, 16, 20, 24, 15, 30, 11, 22, 13, 26, 36, 28, 21, 42, 32, 17, 34, 40, 48, 60, 27, 19, 54, 38, 25, 50, 44, 33, 66, 23, 46, 52, 72, 56, 39, 45, 35, 78, 90, 70, 84, 29, 58, 31, 62, 64, 68, 80, 96, 51, 102, 120, 37, 74, 108, 76, 57, 63, 114, 126, 41, 82, 100, 88, 75, 55, 150, 110, 132, 49, 43, 98, 86, 92, 69, 138, 47, 94, 104, 144, 112, 65, 130, 156, 180, 140, 168, 105, 210, 53, 106, 81, 162, 116, 87, 174, 59, 118, 61, 122, 124, 93, 99, 77, 186, 198, 154, 128, 136, 160, 192, 85, 170, 204, 240, 67, 134, 71, 142, 73, 146, 148, 216, 152, 111, 117, 135, 95, 91, 222, 234, 270, 190, 182, 228, 252, 79, 158, 164, 200, 176, 123, 246, 300, 220, 264, 165, 330, 83, 166, 196, 172, 147, 129, 294, 258, 89, 178, 184, 115, 230, 276, 188, 141, 282, 97, 194, 208, 288, 224, 153, 119, 306, 238, 260, 312, 360, 280, 336, 195, 390, 420, 125, 101, 250, 202, 103, 206, 212, 159, 318, 107, 214, 109, 218, 324, 171, 189, 133, 342, 378, 266, 121, 242, 113, 226, 232, 145, 290, 348, 236, 177, 354, 244, 248, 183, 225, 143, 155, 175, 366, 450, 286, 310, 350, 372, 396, 308, 231, 462, 127, 254, 256, 272, 320, 384, 340, 408, 480, 255, 510, 131, 262, 268, 201, 207, 161, 402, 414, 322, 137, 274, 139, 278, 284, 213, 426, 292, 296, 432, 304, 219, 185, 438, 370, 444, 468, 540, 380, 364, 456, 504, 285, 273, 315, 570, 546, 630, 149, 298, 151, 302, 169, 157, 338, 314, 316, 237, 474, 328, 400, 352, 187, 205, 374, 410, 492, 600, 440, 528, 660, 243, 163, 486, 326, 332, 249, 498, 167, 334, 392, 344, 261, 245, 215, 203, 522, 490, 430, 406, 588, 516, 173, 346, 356, 368, 267, 534, 460, 552, 345, 690, 179, 358, 181, 362, 279, 297, 209, 217, 558, 594, 418, 434, 376, 235, 470, 564, 191, 382, 193, 386, 388, 416, 576, 448, 291, 221, 582, 442, 612, 476, 520, 624, 720, 560, 672, 357, 714, 780, 840, 197, 394, 199, 398, 500, 404, 375, 303, 275, 750, 606, 550, 412, 309, 618, 424, 265, 530, 636, 211, 422, 428, 321, 642, 436, 648, 327, 333, 351, 405, 259, 247, 654, 666, 702, 810, 518, 494, 684, 756, 532, 399, 798, 484, 363, 253, 726, 506, 223, 446, 452, 464, 339, 678, 580, 696, 435, 870, 227, 454, 229, 458, 233, 466, 472, 295, 590, 708, 239, 478, 241, 482, 488, 496, 369, 305, 325, 287, 738, 610, 650, 574, 732, 900, 572, 620, 700, 744, 792, 616, 429, 465, 525, 495, 385, 858, 930, 1050, 990, 770, 924, 251, 502, 508, 381, 441, 387, 301, 762, 882, 774, 602, 512, 257, 514, 544, 640, 768, 680, 816, 960, 1020, 524, 393, 786, 263, 526, 536, 335, 299, 670, 598, 804, 828, 644, 483, 966, 269, 538, 271, 542, 289, 578, 548, 411, 822, 277, 554, 556, 417, 423, 329, 834, 846, 658, 281, 562, 568, 319, 355, 638, 710, 852, 283, 566, 584, 592, 864, 608, 459, 365, 323, 918, 730, 646, 876, 740, 888, 936, 1080, 760, 728, 912, 1008, 555, 585, 455, 1110, 1170, 910, 1140, 1092, 1260, 293, 586, 343, 686, 596, 447, 894, 604, 453, 341, 906, 682, 307, 614, 311, 622, 313, 626, 676, 628, 632, 507, 471, 477, 395, 371, 1014, 942, 954, 790, 742, 948, 317, 634, 656, 800, 704, 425, 850, 748, 820, 984, 1200, 880, 1056, 561, 615, 1122, 1230, 1320, 972, 652, 489, 513, 567, 978, 1026, 1134, 664, 415, 830, 996, 331, 662, 668, 501, 1002, 337, 674, 784, 688, 377, 754, 1044, 980, 860, 812, 1176, 1032, 735, 645, 609, 1470, 1290, 1218, 361, 722, 692, 519, 1038, 347, 694, 349, 698, 531, 413, 1062, 826, 353, 706, 712, 736, 445, 391, 890, 782, 1068, 920, 1104, 1380, 716, 537, 1074, 359, 718, 724, 543, 549, 675, 407, 475, 427, 403, 1086, 1098, 1350, 814, 950, 854, 806, 1116, 1188, 836, 868, 627, 651, 693, 1254, 1302, 1386, 367, 734, 752, 940, 1128, 705, 1410, 373, 746, 379, 758, 764, 573, 1146, 383, 766, 772, 776, 832, 1152, 896, 579, 485, 1158, 970, 1164, 884, 1224, 952, 1040, 1248, 1440, 1120, 1344, 663, 765, 595, 1326, 1530, 1190, 1428, 1560, 1680, 389, 778, 788, 591, 1182, 397, 794, 796, 597, 603, 621, 469, 437, 1194, 1206, 1242, 938, 874, 401, 802, 1000, 808, 451, 505, 902, 1010, 1500, 1212, 1100, 825, 1650, 409, 818, 824, 515, 1030, 1236, 848, 1060, 1272, 795, 1590, 419, 838, 421, 842, 844, 633, 639, 473, 497, 539, 1266, 1278, 946, 994, 1078, 856, 535, 1070, 1284, 431, 862, 433, 866, 872, 1296, 657, 545, 511, 481, 1314, 1090, 1022, 962, 1308, 1332, 1404, 1620, 1036, 988, 1368, 1512, 1064, 777, 741, 855, 819, 945, 665, 1554, 1482, 1710, 1638, 1890, 1330, 1596, 439, 878, 968, 605, 575, 1210, 1150, 1452, 1012, 759, 1518, 443, 886, 892, 669, 1338, 449, 898, 904, 928, 565, 493, 1130, 986, 1356, 1160, 1392, 1740, 908, 681, 1362, 457, 914, 916, 687, 1374, 461, 922, 517, 1034, 463, 926, 932, 944, 699, 1398, 1180, 1416, 885, 1770, 467, 934, 711, 553, 1422, 1106, 956, 717, 1434, 479, 958, 964, 976, 992, 723, 527, 533, 1446, 1054, 1066, 1476, 1220, 1300, 1148, 1464, 1800, 1144, 1240, 1400, 1488, 1584, 1232, 915, 975, 861, 715, 1830, 1950, 1722, 1430, 1716, 1860, 2100, 1980, 1540, 1848, 1155, 2310, 729, 487, 1458, 974, 491, 982, 747, 581, 1494, 1162, 499, 998, 625, 1250, 1004, 753, 1506]


\\ abbnf[1] == 0: no norm relation
\\ abbnf[1] == 1: p-power relation
\\ abbnf[1] == 2: den 1 relation

getbrauer(abbnf) = {
  my(pol,abgal,cyc,cycnc,LsubCP,Lp,brauer);
  if(abbnf[1]==1,
    abbnf[23]
  ,abbnf[1]==2,
    pol = getpol(abbnf);
    abgal = abgaloisanalysis(pol);
    cyc = abgal_cyc(abgal);
    cycnc = vecprod(cyc[2..-1]);
    LsubCP = getsubfields_CP(abgal,'y,0,0);
    Lp = factor(poldegree(pol))[,1]~;
    brauer = LsubCP[,2]~;
    vector(#Lp,i,vector(#brauer,j,brauer[j][i]));
  );
}

geth(abbnf) = {
  my(h,clgp);
  h = 1;
  clgp = getcyc(abbnf);
  for(i=1,#clgp,
    h *= clgp[i];
  );
  h;
}

getdisc(abbnf) =
{
  if(abbnf[1]==2, poldisc(getpol(abbnf));
  ,abbnf[1]==1, abbnf[18]
  ,/*else: 0*/ abbnf[2].disc
  );
};

getreg(abbnf, con) = 
{
  my(res,w,disc,r1,r2,h,Lbnf,bcoefs,brauer);
  if(abbnf[1]==0, 
    abbnf[2].reg
  ,abbnf[1]==1,
    res = getresidue(abbnf);
    w = abbnf[25];
    disc = getdisc(abbnf);
    [r1, r2] = abbnf[24];
    h = geth(abbnf);

    (res*w*sqrt(abs(disc)))/((2^r1)*((2*Pi)^r2)*h);
  ,abbnf[1]==2,
    nf = nfinit(getpol(abbnf));
    res = getresidue(abbnf);
    w = if(Mod(con,2)==0,con,2*con);
    disc = getdisc(abbnf);
    [r1, r2] = nf.sign;
    h = geth(abbnf);

    (res*w*sqrt(abs(disc)))/((2^r1)*((2*Pi)^r2)*h);
  );
}

\\ requires abbnf[1] == 1 aka p-power norm relation
getresidue(abbnf) =
{
  my(bcoefs,Lbnf,bnf,d,r1,r2,h,R,w,subres,res);
  if(abbnf[1] == 0,
    bnf = abbnf[2];
    [r1,r2] = bnf.sign;
    h = bnf.clgp.no;
    reg = bnf.reg;
    w = bnf.tu[1];
    d = bnf.nf.disc;

    res = (h*reg*(2^r1)*((2*Pi)^r2))/(w*sqrt(abs(d)));
    res;
  ,abbnf[1] == 1,
    bcoefs = getbrauer(abbnf);
    Lbnf = abbnf[5];

    res = 1;
    for(i=1,#Lbnf,
      subres = getresidue(Lbnf[i]);
      /*
      bnf = Lbnf[i][2];
      d = bnf.nf.disc;
      [r1, r2] = bnf.sign;
      h = bnf.clgp.no;
      R = bnf.reg;
      w = bnf.tu[1];

      subres = (h*R*(2^r1)*((2*Pi)^r2))/(w*sqrt(abs(d)));
      */
      res *= subres^bcoefs[i];
    );
    res;
  ,abbnf[1] == 2,
    bcoefs = getbrauer(abbnf);
    Lbnf = abbnf[3];
    res = 1;
    for(i=1,#Lbnf,
      res *= getresidue(Lbnf[i])^bcoefs[1][i];
    );
    res;
  );

}

verify(abbnf,con,r1,r2,h,reg,res) = {
  my(e,w,disc,nf,rhs);
  w = if(Mod(con,2)==0,con,2*con);
  disc = getdisc(abbnf);
  rhs = (h*reg*(2^r1)*((2*Pi)^r2))/(w*sqrt(abs(disc)));
  p = -default(realprecision) + 1;
  abs(res-rhs) < 10.0^p;
}

\\ tech = [0,0,4] in aurels code 
\\ [0.5,0.5,4] needed to finish subfield of deg 1800 field in norm relation computations 
nfdata(pol, tech=[0,0,4]) = 
{
  my(bnf,deg,disc,disc_bits,reg,h);
  \\con = conductors[idx];
  nf = easynf(pol);
  bnf = bnfinit(nf, 1, tech);

  deg = poldegree(pol);
  disc = bnf.nf.disc;
  disc_bits = floor(log(abs(disc))/log(2)) + 1;
  reg = bnf.reg;
  h = bnf.clgp.no;

  s = strprintf(
    "{ \"degree\": %d, \"polynomial\": %d, \"discriminant_bits\": %d, \"h\": %d, \"regulator\": %f }",
  deg, pol, disc_bits, h, reg
  );

  print(s)
}

cyclodata(conductor, p=100) = 
{
  my(pol,bnf,deg,disc,disc_bits,reg,h);
  \\con = conductors[idx];
  \\con = idx;
  default(realprecision, p);
  pol = polcyclo(conductor);
  abbnf = abelianbnfinit(pol);
  nf = easynf(pol);
  [r1,r2] = nf.sign;

  deg = poldegree(pol);
  disc = getdisc(abbnf);
  disc_bits = floor(log(abs(disc))/log(2));
  galgp = znstar(conductor)[2];
  clgp = getcyc(abbnf);
  h = geth(abbnf);
  reg = getreg(abbnf,conductor);
  hm = hminus(conductor);
  hp = h/hm;
  res = getresidue(abbnf);

  b = verify(abbnf,conductor,r1,r2,h,reg,res);
  if(b==0,error("Unable to verify!"));

  s = strprintf(
    "{ \"conductor\": %d, \"degree\": %d, \"polynomial\": %d, \"signature\": %d, \"norm_relation\": %d, \"discriminant\": %s, \"discriminant_bits\": %d, \"galois_group\": %d, \"class_group\": %d, \"h\": %s, \"h_minus\": %s, \"h_plus\": %s, \"regulator\": %s, \"residue\": %s}",
    conductor, 
    deg, 
    Vec(pol),
    [r1,r2], 
    abbnf[1], 
    strprintf("\"%d\"", disc), 
    disc_bits, 
    galgp, 
    clgp, 
    strprintf("\"%d\"", h), 
    strprintf("\"%d\"", hm), 
    strprintf("\"%d\"", hp), 
    strprintf("\"%f\"", reg), 
    strprintf("\"%f\"", res)
  );

  print(s)
}
